<link href="{{url_for('static', filename='bootstrap.min.css')}}" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" rel="stylesheet">
<link href="{{url_for('static', filename='styles.css')}}" rel="stylesheet">

<style>
    .speech-data-columns{
        height: 100%;
        background: white;
    }
    input[type="file"] {
        display: none;
    }
    .custom-file-upload {
        background-color: #5fa9e8;
        display: flex;
        align-items: center;
        cursor: pointer;
        border-radius: 10px;
        height: 80px;
    }
    .upload-button-text {
        text-align: center;
    }
    .record-button{
        height:90px; 
        width:90px; 
        border-radius:50%; 
        background-color:red;
        border:0px;
        outline: none;
        box-shadow: 0 0 0 red;
        animation: none;
    }

    .statsPanel{
        padding-top: 10px;
        padding-bottom: 10px;
        margin-top: 30px;
        margin-bottom: 10px;
        border: 1px lightgray solid;
        border-radius: 10px;
    }
    .panelBottom{
        background-color:white;
    }
    div.entry{
        padding-top: 10px;
        padding-bottom: 10px;
        padding-left: 10px;
        padding-right: 10px;

    }

    @keyframes pulse {
        0% {
            box-shadow: 0 0 0 0 red;
        }
        70% {
             box-shadow: 0 0 0 10px rgba(204,169,44, 0);
        }
        100% {
            box-shadow: 0 0 0 0 rgba(204,169,44, 0);
        }
    }
</style>

<div class="container-fluid">

    <div class="row" style="height:100px; background:white; margin:0.5%; display:flex; align-items: center;">
        <div class="col-md-8 col-xs-6">
            <h1><b>SpeakYourDreams</b></h1>
        </div>
        <div class="col-md-1 col-xs-2">
            <label for="file-upload" class="custom-file-upload">
                <h4 class="upload-button-text">Upload Transcript</h4>
            </label>
            <input id="file-upload" type="file"/>  
        </div>
        <div class="col-md-1 col-xs-2">
            <label for="file-upload" class="custom-file-upload">
                <h4 class="upload-button-text">Upload Audio</h4>
            </label>
            <input id="file-upload" type="file"/>        
        </div>
        <div class="col-md-2 col-xs-2" style="text-align: center;">
            <button class="record-button" id="record_button">
                <i class="fa fa-microphone" style="font-size:48px; color:white;"></i>
            </button>
        </div>
    </div>

    <div class="row" style="height:700px;">

        <!--Side bar-->
        <div class="col-md-2 col-xs-12 speech-data-columns" style="margin:1%; border-radius:10px;">

            <div class="row" 
                style="background-color:rgb(237, 101, 127); border-radius:15px; margin:5px">
                
                <h4 style="text-align:center; padding-top:2px; padding-bottom:2px;">Statistics</h4>
            </div>
            
            <div class="row statsPanel">
                <div class="row no-padding" class="sidebar-stats" style="text-align: center;">
                    <i class="fa fa-xl fa-clock color-teal"></i>
                    <div class="large" id="wpm">100</div>
                    <div class="text-muted">WPM</div>
                </div>
            </div>

            <div class="row statsPanel" style="display:flex; justify-content:center; align-items:center;">
                
                <div class="col-md-3">
                    <i class="fa fa-xl fa-comments color-blue"></i>
                    <div class="large" id="repeated_counter">52</div>
                    <div class="text-muted">Repeated Words</div>
                </div>
                <div class="col-md-9">
                    <ul id="repeats">
                        <li>Like: 15</li>
                        <li>Math: 20</li>
                        <li>Rags: 4</li>
                    </ul>
                </div>
            </div>

            <div class="row statsPanel" style="text-align:center;">
                    <img src="{{url_for('static',filename='download.png')}}" style='width: 45px; height: 45px;'>
                    <div class="large" id="pauses">24</div>
                    <div class="text-muted">Potentially Awkward Pauses</div>
            </div>

            <div class="row statsPanel" style="text-align:center;">
                <i class="fa fa-xl fa fa-ban color-red"></i>
                <div class="large" id="fillers">12</div>
                <div class="text-muted">Fillers</div>
            </div>

        </div>

        <!--This is where the textbox/playback will be-->
        <div class="col-md-9 col-xs-12 speech-data-columns" style="margin: 1%; border-radius:10px">
            <div class="row" style="height:87.5%; background:lightblue; border-radius: 10px;">
                <p class="text" id="main_text" style="padding: 10px;">
                    This is where users will write
                </p>
            </div>
            <div class="row" style="text-align:center;">
                <div class="slidecontainer">
                    <input type="range" min="1" max="100" value="50" class="slider" id="myRange">
                </div>
                <div>
                    <button style="background-color:#ffffff; border:none" id="play_pause">
                        <i class="fa fa-pause" style="font-size:30px; color:black;" aria-hidden="false"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!--Bottom bar-->
    <div class="row" style="margin-top: 1%;">

        <div class="col-xs-12 col-md-3">
            <div class="panelBottom" id="category">
                <div class="row entry">
                    <div class="col-md-3 col-xs-12">
                        Happy
                    </div>
                    <div class="progress col-md-8 col-xs-11">
                        <div class="progress-bar" role="progressbar" aria-valuenow="50" aria-valuemin="50" aria-valuemax="100"></div>
                    </div>
                </div>

                <div class="row entry">
                    <div class="col-md-3 col-xs-12">
                        Happy
                    </div>
                    <div class="progress col-md-8 col-xs-11">
                        <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>

                <div class="row entry">
                    <div class="col-md-3 col-xs-12">
                        Happy
                    </div>
                    <div class="progress col-md-8 col-xs-11">
                        <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xs-12 col-md-3">
            <div class="panelBottom">
                <div class="easypiechart-panel" id="wpm">
                    <h4>Pronunciation</h4>
                    <div class="easypiechart" id="easypiechart-red" data-percent="27" ><span class="percent">27%</span></div>
                </div>
            </div>
        </div>
        
        <div class="col-xs-12 col-md-3">
            <div class="panelBottom" id="emotions">
                <div class="row entry">
                    <div class="col-md-3 col-xs-12">
                        Happy
                    </div>
                    <div class="progress col-md-8 col-xs-11">
                        <div class="progress-bar" role="progressbar" aria-valuenow="50" aria-valuemin="50" aria-valuemax="100"></div>
                    </div>
                </div>

                <div class="row entry">
                    <div class="col-md-3 col-xs-12">
                        Happy
                    </div>
                    <div class="progress col-md-8 col-xs-11">
                        <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>

                <div class="row entry">
                    <div class="col-md-3 col-xs-12">
                        Happy
                    </div>
                    <div class="progress col-md-8 col-xs-11">
                        <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xs-12 col-md-3">
            <div class="panelBottom">
                <div class="easypiechart-panel" id="finalgrade">
                    <h4>Final</h4>
                    <div class="easypiechart" id="easypiechart-blue" data-percent="27" ><span class="percent">27%</span></div>
                </div>
            </div>
        </div>

    </div>

</div>

<script>
    var record_button = document.getElementById("record_button");
    var main_text = document.getElementById("main_text"); // where the speech will be transcribed
    var play_pause = document.getElementById("play_pause");

    // sidebar
    var wpm = document.getElementById("wpm");
    var repeats = document.getElementById("repeats");
    var repeatedCounter = document.getElementById("repeated_counter");
    var pauses = document.getElementById("pauses");
    var fillers = document.getElementById("fillers");
    var fillersCounter = document.getElementById("fillers_counter");

    // bottom complex statistics
    var finalGrade = document.getElementById("finalgrade");
    var emotions = document.getElementById("emotions")
    var category = document.getElementById("category")
    var pronunciation = document.getElementById("pronunciation")


    var recording = false;
    record_button.addEventListener("click", function(){
        if(recording){
            record_button.style.animation="none";
            recording=false;
        }
        else{
            record_button.style.animation="pulse 2s infinite";
            recording=true;
        }
    })

    var play = true;
    play_pause.addEventListener("click", function(){
        if(play){
            play_pause.innerHTML="<i class='fa fa-play' style='font-size:30px; color:black; display: block' aria-hidden='false'></i>"
            play=false;
        }
        else{
            play_pause.innerHTML="<i class='fa fa-pause' style='font-size:30px; color:black; display: block' aria-hidden='false'></i>"
            play=true;
        }
    })

    function updateWPM(number){
        wpm.innerHTML = number
    }

    function updatePauses(number){
        pauses.innerHTML = number
    }

    // upload filler words
    function addFillers(number){
        fillers.innerHTML = number
    }

    // words should be a dictionary with word and corresponding occurances
    function addRepeatedWords(words){
        for(let word in words){
            const new_list_entry = document.createElement("li");
            const entry_text = word + ": " + words[word];
            new_list_entry = entry_text;
            pauses.append(new_list_entry);
        }
        repeatedCounter.innerHTML = Object.keys(words).length
    }

    function addRepeatedWords(words){
        for(let word in words){
            const new_list_entry = document.createElement("li");
            const entry_text = word + ": " + words[word];
            new_list_entry = entry_text;
            pauses.append(new_list_entry);
        }
        repeatedCounter.innerHTML = Object.keys(words).length
    }



</script>

<script src="{{url_for('static', filename='jquery-1.11.1.min.js')}}"></script>
<script src="{{url_for('static', filename='chart.min.js')}}"></script>
<script src="{{url_for('static', filename='chart-data.js')}}"></script>
<script src="{{url_for('static', filename='easypiechart.js')}}"></script>
<script src="{{url_for('static', filename='easypiechart-data.js')}}"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>